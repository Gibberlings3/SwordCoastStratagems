//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               overarching clone
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

DEFINE_ACTION_FUNCTION clone_vvc
    STR_VAR
           vvc=""
           edits=""
           editstring=""
           allow_missing=0
    BEGIN
         LAUNCH_ACTION_FUNCTION clone_template
                  STR_VAR file_list= ~%vvc%~
                          file_ext=~VVC~
                          edits
                          editstring
                          allow_missing
         END
END


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               overarching edit
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

DEFINE_ACTION_FUNCTION edit_vvc
    STR_VAR
           vvc=""
           edits=""
           editstring=""
           allow_missing=0
    BEGIN
         LAUNCH_ACTION_FUNCTION edit_template
                  STR_VAR file_list= ~%vvc%~
                          file_ext=~VVC~
                          edits
                          editstring
                          allow_missing
         END
END


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               overarching install
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

DEFINE_ACTION_FUNCTION install_vvc
    INT_VAR
           allow_missing=0
    STR_VAR
           vvc=""
           edits=""
           editstring=""
           external_file=""
           location=""
           locbase=""
    BEGIN
         LAUNCH_ACTION_FUNCTION install_template
	          INT_VAR allow_missing
                  STR_VAR file_list= ~%vvc%~
                          file_ext=~VVC~
                          edits editstring external_file location locbase

         END
END


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               overarching make
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

DEFINE_ACTION_FUNCTION make_vvc
    STR_VAR
           vvc=""
           edits=""
           editstring=""
    BEGIN
         LAUNCH_ACTION_FUNCTION make_template
                  STR_VAR file_list= ~%vvc%~
                          file_ext=~VVC~
                          edits= ~%edits%~
                          editstring= ~%editstring%~
                          build_before= VVC_build
                          build_after = VVC_postbuild
         END
END

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               offsets  [none]
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               simple data-field edits
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
ACTION_DEFINE_ASSOCIATIVE_ARRAY vvc_fields BEGIN
   anim=>~0x8,ASCII~
   anim0=>~0x8,ASCII~
   x_pos=>~0x28,LONG~
   y_pos=>~0x2c,LONG~
   orientation=>~0x30,LONG~
   frame_rate=>~0x34,LONG~
   num_orient=>~0x38,LONG~
   palette=>~0x44,ASCII~
   z_pos=>~0x4c,LONG~
   ctr_x=>~0x50,LONG~
   ctr_y=>~0x54,LONG~
   brightness=>~0x58,LONG~
   num_frames=>~0x5c,LONG~
   seq_start=>~0x68,LONG~
   seq_middle=>~0x6c,LONG~
   seq_current=>~0x70,LONG~
   continuous=>~0x74,LONG~
   wav_start=>~0x78,ASCII~
   wav_middle=>~0x80,ASCII~
   wav_start0=>~0x78,ASCII~
   wav_middle0=>~0x80,ASCII~
   alpha=>~0x88,ASCII~
   seq_end=>~0x90,LONG~
   wav_end=>~0x94,ASCII~
   wav_end0=>~0x94,ASCII~
END

LAUNCH_ACTION_FUNCTION build_simple_data_field_editors STR_VAR lookup_table=vvc_fields function_prefix=VVC END

ACTION_DEFINE_ASSOCIATIVE_ARRAY vvc_bit_fields BEGIN
      transparent=>~0x18,0~
      translucent=>~0x18,1~
      translucent_shadow=>~0x18,2~
      blended=>~0x18,3~
      mirror_x=>~0x18,4~
      mirror_y=>~0x18,5~
      clip=>~0x18,6~
      copy_from_back=>~0x18,7~
      clear_fill=>~0x19,0~
      3d_blend=>~0x19,1~
      ignore_wall=>~0x19,2~
      ignore_timestop=>~0x19,3~
      ignore_dream=>~0x19,4~
      2d_blend=>~0x19,5~
      not_light_source=>~0x1a,0~
      light_source=>~0x1a,1~
      internal_brightness=>~0x1a,2~
      timestopped=>~0x1a,3~
      sepia=>~0x1b,2~
      looping=>~0x20,0~
      special_lighting=>~0x20,1~
      modify_for_height=>~0x20,2~
      draw_animation=>~0x20,3~
      custom_palette=>~0x20,4~
      purgeable=>~0x20,5~
      ignore_wallgroups=>~0x20,6~
      mid_level_brighten=>~0x20,7~
      high_level_brighten=>~0x21,0~
      orbit_target=>~0x40,0~
      relative_to_target=>~0x40,1~
      ignore_orientation=>~0x40,3~
END

LAF build_flag_data_field_editors STR_VAR lookup_table=vvc_bit_fields function_prefix=VVC  END

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////               builders
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

DEFINE_PATCH_FUNCTION VVC_build
BEGIN
       INSERT_BYTES 0x0 0x1ec
       WRITE_ASCII  0x000 ~VVC V1.0~
       LPF VVC_draw_animation STR_VAR arguments=1 END
       LPF VVC_frame_rate STR_VAR arguments=15 END
       LPF VVC_num_orient STR_VAR arguments=1 END
       LPF VVC_num_frames STR_VAR arguments=~-1~ END
END
DEFINE_PATCH_FUNCTION VVC_postbuild  BEGIN END
