//////////////////////////////////////////////////////////////////////////////////
///
///   Define actions
///
////////////////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/beholder/ssl/beholder_definitions.ssl)
INCLUDE FILE(%scsroot%/caster_shared/caster_definitions.ssl)
VARIABLE(beholderinvischeck=!StateCheck(scstarget,STATE_INVISIBLE))
VARIABLE(IsBeholder=True)

////////////////////////////////////////////////////////////////
/// Labelling, break-invisibility, hostile-undead, panic, etc
////////////////////////////////////////////////////////////////////////////////////////


INCLUDE FILE(%scsroot%/mage/ssl/main/preamble.ssl)

////////////////////////////////////////////////////////////////
/// Beholder eyestalk setup
////////////////////////////////////////////////////////////////////////////////////////

IF
	See(NearestEnemyOf(Myself))
	!Global("initialise","LOCALS",1)
THEN
	RESPONSE #500
		SetGlobalTimer("SeeBounce","LOCALS",4)
		SetGlobalTimer("used_lethal_eyestalk","LOCALS",12)
		SetGlobal("inafight","LOCALS",1)
		SetGlobal("initialise","LOCALS",1)
		SetGlobalTimer("rtime","LOCALS",2000)
		Continue()
END

//////////////////////////////////////////////////////////////////
///////    Elder orbs have a few non-functional eyes
//////////////////////////////////////////////////////////////////

IF
     !Global("tyrant_initialise","LOCALS",1)
THEN
    RESPONSE #100
             SetGlobal("tyrant_initialise","LOCALS",1)
             ApplySpellRES("dw#tyset",Myself)
             ApplySpellRES("dw#tyset",Myself)
             ApplySpellRES("dw#tyset",Myself)
             Continue()
END

//////////////////////////////////////////////////////////////////////////////////
////	Setup, prep
//////////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/mage/ssl/main/magesetup.ssl)



//////////////////////////////////////////////////////////////////////////////////
////	If non-hostile, closedown - this script doesn't pretend to fight bad guys
//////////////////////////////////////////////////////////////////////////////////

IF
	!Allegiance(Myself,ENEMY)
	IgnoreBlock(IsPartyAlly)
THEN
	RESPONSE #100
		NoAction()
END


//////////////////////////////////////////////////////////////////////
///CPU saver
//////////////////////////////////////////////////////////////////////

IF
	!Detect(NearestEnemyOf(Myself))
	!HPPercentLT(Myself,100)
	!Global("inafight","LOCALS",1)
THEN
	RESPONSE #100
		NoAction()
END

////////////////////////////////////////////////////////////////////////////
///	Contingencies renew defences
////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/mage/ssl/generalblocks/contingency.ssl)

///////////////////////////////////////////////////////////////////////////
////	Flee Cloudkill spell
///////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/mage/ssl/generalblocks/fleecloud_fm.ssl)


////////////////////////////////////////////////////////////////////////////////////////
////	Kill the timer if we're using Alacrity
////////////////////////////////////////////////////////////////////////////////////////

IF
        SSLBoolean(WIZARD_IMPROVED_ALACRITY|WIZARD_WISH)
	CheckStatGT(Myself,0,WIZARD_IMPROVED_ALACRITY)
	GlobalTimerNotExpired("castspell","LOCALS")
THEN
	RESPONSE #100
		SetGlobalTimer("castspell","LOCALS",0)
END

//////////////////////////////////////////////////////////////////////////
// Easiest-level block
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER()
INCLUDE FILE(%scsroot%/mage/ssl/generalblocks/easy.ssl)

//////////////////////////////////////////////////////////////////////////
// Look for PCs
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER(!GlobalTimerNotExpired("castspell","LOCALS"))


INCLUDE FILE(%scsroot%/mage/ssl/generalblocks/chase.ssl)

///////////////////////////////////////////////////////////////////////////////
//	Antimagic ray
/////////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/beholder/ssl/beholder_antimagic.ssl)

///////////////////////////////////////////////////////////////////////////////
//	First attack section
/////////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/beholder/ssl/beholder_attack1.ssl)

////////////////////////////////////////////////////////////////////////////
// Core magic block
///////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER()
INCLUDE FILE(%scsroot%/mage/ssl/magetypes/ssl_mage_type.ssl)

///////////////////////////////////////////////////////////////////////////////
//	Second attack section
/////////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/beholder/ssl/beholder_attack2.ssl)


////////////////////////////////////////////////////////////////////////////
// Deactivate alacrity instruction for fast casting if relevant
///////////////////////////////////////////////////////////////////////////

IF
	SSLBoolean(WIZARD_IMPROVED_ALACRITY|WIZARD_WISH)
        ActionListEmpty()
	CheckStatGT(Myself,0,WIZARD_IMPROVED_ALACRITY)
	!Global("alacritycompromise","LOCALS",1)
THEN
	RESPONSE #100
		SetGlobal("alacritycompromise","LOCALS",1)
END

DEFAULT TRIGGER()
////////////////////////////////////////////////////////////////////////////
// Closedown
///////////////////////////////////////////////////////////////////////////


INCLUDE FILE(%scsroot%/mage/ssl/generalblocks/closedown.ssl)
